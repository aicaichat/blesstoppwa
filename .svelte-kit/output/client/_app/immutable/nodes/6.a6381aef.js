import{s as vt,n as Ne,e as st,o as ht,r as ut,i as Ue,b as at}from"../chunks/scheduler.c332f3f7.js";import{S as mt,i as pt,g as i,s as x,x as bt,h as r,f as v,c as y,j as w,k as n,y as l,a as O,z as V,m as te,n as le,A as ce,o as de}from"../chunks/index.a647b513.js";import{g as _t}from"../chunks/globals.7f7f1b26.js";import{s as R,t as me,u as gt,g as nt}from"../chunks/appState.b697c72e.js";import{p as xt}from"../chunks/stores.7d086311.js";const{document:je}=_t;function it(a){let e,s='<div class="w-20 h-20 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div> <h2 class="text-2xl font-semibold text-yellow-100 mb-4">正在验证手串真伪</h2> <p class="text-yellow-200">请稍候，正在连接古寺数据库...</p>';return{c(){e=i("div"),e.innerHTML=s,this.h()},l(t){e=r(t,"DIV",{class:!0,"data-svelte-h":!0}),V(e)!=="svelte-f1we7g"&&(e.innerHTML=s),this.h()},h(){n(e,"class","text-center")},m(t,u){O(t,e,u)},d(t){t&&v(e)}}}function rt(a){var Je,Qe,We,Xe,Ye;let e,s,t,u,b='<h1 class="text-3xl font-bold gradient-text mb-2 svelte-cr46zk">开光证书</h1> <p class="text-yellow-200">千年古寺认证</p>',f,c,d,o,g,C="手串编号",T,m,E,I,D,H,q="区块链哈希",h,p,_=((Je=a[4].certificateData)==null?void 0:Je.hash)+"",B,P,G,J,Oe="开光法师",Ee,se,fe=((Qe=a[4].certificateData)==null?void 0:Qe.sign)+"",pe,Ie,j,Q,W,Se="认证寺院",Le,ae,ue=((We=a[4].certificateData)==null?void 0:We.templeName)+"",be,Ve,X,Y,ze="开光时间",Te,ne,ve=((Xe=a[4].certificateData)!=null&&Xe.mintedAt?new Date(a[4].certificateData.mintedAt).toLocaleDateString("zh-CN"):"")+"",_e,Me,ie,Fe='<label class="block text-sm font-medium text-yellow-300 mb-1">验证状态</label> <div class="flex items-center gap-2"><span class="w-3 h-3 bg-green-500 rounded-full"></span> <span class="text-green-400 font-medium">已认证</span></div>',Ae,Z,Re='<div class="inline-block p-4 border-2 border-yellow-500 rounded-full"><div class="text-2xl text-yellow-500">⚡</div></div> <p class="mt-2 text-yellow-300 text-sm">开光认证印章</p>',He,U,N,ge,Be,xe,K,qe="继续体验 →",Pe,Ke,M=((Ye=a[4].certificateData)==null?void 0:Ye.videoUrl)&&ot(a);function Ge(k,L){return k[4].status==="generating_pdf"?wt:yt}let ye=Ge(a),S=ye(a),A=a[4].status==="pdf_ready"&&ct(a);return{c(){e=i("div"),M&&M.c(),s=x(),t=i("div"),u=i("div"),u.innerHTML=b,f=x(),c=i("div"),d=i("div"),o=i("div"),g=i("label"),g.textContent=C,T=x(),m=i("div"),E=te(a[0]),I=x(),D=i("div"),H=i("label"),H.textContent=q,h=x(),p=i("div"),B=te(_),P=x(),G=i("div"),J=i("label"),J.textContent=Oe,Ee=x(),se=i("div"),pe=te(fe),Ie=x(),j=i("div"),Q=i("div"),W=i("label"),W.textContent=Se,Le=x(),ae=i("div"),be=te(ue),Ve=x(),X=i("div"),Y=i("label"),Y.textContent=ze,Te=x(),ne=i("div"),_e=te(ve),Me=x(),ie=i("div"),ie.innerHTML=Fe,Ae=x(),Z=i("div"),Z.innerHTML=Re,He=x(),U=i("div"),N=i("button"),S.c(),Be=x(),A&&A.c(),xe=x(),K=i("button"),K.textContent=qe,this.h()},l(k){e=r(k,"DIV",{class:!0});var L=w(e);M&&M.l(L),s=y(L),t=r(L,"DIV",{class:!0});var z=w(t);u=r(z,"DIV",{class:!0,"data-svelte-h":!0}),V(u)!=="svelte-ul6oll"&&(u.innerHTML=b),f=y(z),c=r(z,"DIV",{class:!0});var $=w(c);d=r($,"DIV",{class:!0});var F=w(d);o=r(F,"DIV",{});var ee=w(o);g=r(ee,"LABEL",{class:!0,"data-svelte-h":!0}),V(g)!=="svelte-ynisew"&&(g.textContent=C),T=y(ee),m=r(ee,"DIV",{class:!0});var he=w(m);E=le(he,a[0]),he.forEach(v),ee.forEach(v),I=y(F),D=r(F,"DIV",{});var we=w(D);H=r(we,"LABEL",{class:!0,"data-svelte-h":!0}),V(H)!=="svelte-1wtif43"&&(H.textContent=q),h=y(we),p=r(we,"DIV",{class:!0});var Ze=w(p);B=le(Ze,_),Ze.forEach(v),we.forEach(v),P=y(F),G=r(F,"DIV",{});var De=w(G);J=r(De,"LABEL",{class:!0,"data-svelte-h":!0}),V(J)!=="svelte-1oourr4"&&(J.textContent=Oe),Ee=y(De),se=r(De,"DIV",{class:!0});var $e=w(se);pe=le($e,fe),$e.forEach(v),De.forEach(v),F.forEach(v),Ie=y($),j=r($,"DIV",{class:!0});var re=w(j);Q=r(re,"DIV",{});var ke=w(Q);W=r(ke,"LABEL",{class:!0,"data-svelte-h":!0}),V(W)!=="svelte-12nl3rt"&&(W.textContent=Se),Le=y(ke),ae=r(ke,"DIV",{class:!0});var et=w(ae);be=le(et,ue),et.forEach(v),ke.forEach(v),Ve=y(re),X=r(re,"DIV",{});var Ce=w(X);Y=r(Ce,"LABEL",{class:!0,"data-svelte-h":!0}),V(Y)!=="svelte-ftmogf"&&(Y.textContent=ze),Te=y(Ce),ne=r(Ce,"DIV",{class:!0});var tt=w(ne);_e=le(tt,ve),tt.forEach(v),Ce.forEach(v),Me=y(re),ie=r(re,"DIV",{"data-svelte-h":!0}),V(ie)!=="svelte-1ty0pf5"&&(ie.innerHTML=Fe),re.forEach(v),$.forEach(v),Ae=y(z),Z=r(z,"DIV",{class:!0,"data-svelte-h":!0}),V(Z)!=="svelte-1pbxdnj"&&(Z.innerHTML=Re),z.forEach(v),He=y(L),U=r(L,"DIV",{class:!0});var oe=w(U);N=r(oe,"BUTTON",{class:!0});var lt=w(N);S.l(lt),lt.forEach(v),Be=y(oe),A&&A.l(oe),xe=y(oe),K=r(oe,"BUTTON",{class:!0,"data-svelte-h":!0}),V(K)!=="svelte-coth45"&&(K.textContent=qe),oe.forEach(v),L.forEach(v),this.h()},h(){n(u,"class","text-center mb-6"),n(g,"class","block text-sm font-medium text-yellow-300 mb-1"),n(m,"class","text-yellow-100 font-mono text-lg"),n(H,"class","block text-sm font-medium text-yellow-300 mb-1"),n(p,"class","text-yellow-100 font-mono text-sm break-all"),n(J,"class","block text-sm font-medium text-yellow-300 mb-1"),n(se,"class","text-yellow-100"),n(d,"class","space-y-4"),n(W,"class","block text-sm font-medium text-yellow-300 mb-1"),n(ae,"class","text-yellow-100"),n(Y,"class","block text-sm font-medium text-yellow-300 mb-1"),n(ne,"class","text-yellow-100"),n(j,"class","space-y-4"),n(c,"class","grid grid-cols-1 md:grid-cols-2 gap-6"),n(Z,"class","mt-8 text-center"),n(t,"class","backdrop-blur-subtle rounded-2xl p-8 border-2 border-yellow-500/50 mb-8 svelte-cr46zk"),N.disabled=ge=a[4].status==="generating_pdf",n(N,"class","px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold rounded-xl hover:from-blue-500 hover:to-blue-400 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"),n(K,"class","px-6 py-3 bg-gradient-to-r from-yellow-600 to-yellow-500 text-black font-semibold rounded-xl hover:from-yellow-500 hover:to-yellow-400 transition-all duration-300"),n(U,"class","flex flex-col sm:flex-row gap-4 justify-center"),n(e,"class","w-full max-w-4xl")},m(k,L){O(k,e,L),M&&M.m(e,null),l(e,s),l(e,t),l(t,u),l(t,f),l(t,c),l(c,d),l(d,o),l(o,g),l(o,T),l(o,m),l(m,E),l(d,I),l(d,D),l(D,H),l(D,h),l(D,p),l(p,B),l(d,P),l(d,G),l(G,J),l(G,Ee),l(G,se),l(se,pe),l(c,Ie),l(c,j),l(j,Q),l(Q,W),l(Q,Le),l(Q,ae),l(ae,be),l(j,Ve),l(j,X),l(X,Y),l(X,Te),l(X,ne),l(ne,_e),l(j,Me),l(j,ie),l(t,Ae),l(t,Z),a[13](t),l(e,He),l(e,U),l(U,N),S.m(N,null),l(U,Be),A&&A.m(U,null),l(U,xe),l(U,K),Pe||(Ke=[ce(N,"click",a[6]),ce(K,"click",a[8])],Pe=!0)},p(k,L){var z,$,F,ee,he;(z=k[4].certificateData)!=null&&z.videoUrl?M?M.p(k,L):(M=ot(k),M.c(),M.m(e,s)):M&&(M.d(1),M=null),L&1&&de(E,k[0]),L&16&&_!==(_=(($=k[4].certificateData)==null?void 0:$.hash)+"")&&de(B,_),L&16&&fe!==(fe=((F=k[4].certificateData)==null?void 0:F.sign)+"")&&de(pe,fe),L&16&&ue!==(ue=((ee=k[4].certificateData)==null?void 0:ee.templeName)+"")&&de(be,ue),L&16&&ve!==(ve=((he=k[4].certificateData)!=null&&he.mintedAt?new Date(k[4].certificateData.mintedAt).toLocaleDateString("zh-CN"):"")+"")&&de(_e,ve),ye!==(ye=Ge(k))&&(S.d(1),S=ye(k),S&&(S.c(),S.m(N,null))),L&16&&ge!==(ge=k[4].status==="generating_pdf")&&(N.disabled=ge),k[4].status==="pdf_ready"?A?A.p(k,L):(A=ct(k),A.c(),A.m(U,xe)):A&&(A.d(1),A=null)},d(k){k&&v(e),M&&M.d(),a[13](null),S.d(),A&&A.d(),Pe=!1,ut(Ke)}}}function ot(a){let e,s,t,u,b,f,c,d,o,g="🙏 开光仪式视频",C,T,m=!a[3]&&dt();return{c(){e=i("div"),s=i("div"),t=i("video"),u=i("track"),c=x(),m&&m.c(),d=x(),o=i("p"),o.textContent=g,this.h()},l(E){e=r(E,"DIV",{class:!0});var I=w(e);s=r(I,"DIV",{class:!0});var D=w(s);t=r(D,"VIDEO",{src:!0,class:!0,poster:!0});var H=w(t);u=r(H,"TRACK",{kind:!0,src:!0,srclang:!0,label:!0}),H.forEach(v),c=y(D),m&&m.l(D),D.forEach(v),d=y(I),o=r(I,"P",{class:!0,"data-svelte-h":!0}),V(o)!=="svelte-14ppads"&&(o.textContent=g),I.forEach(v),this.h()},h(){n(u,"kind","captions"),Ue(u.src,b="/videos/blessing-captions.vtt")||n(u,"src",b),n(u,"srclang","zh"),n(u,"label","中文字幕"),Ue(t.src,f=a[4].certificateData.videoUrl)||n(t,"src",f),t.autoplay=!0,t.muted=!0,t.loop=!0,t.playsInline=!0,n(t,"class","w-full h-auto"),n(t,"poster","/images/blessing-poster.jpg"),n(s,"class","relative inline-block rounded-2xl overflow-hidden max-w-2xl"),n(o,"class","mt-4 text-yellow-200 text-lg"),n(e,"class","mb-8 text-center")},m(E,I){O(E,e,I),l(e,s),l(s,t),l(t,u),a[12](t),l(s,c),m&&m.m(s,null),l(e,d),l(e,o),C||(T=ce(t,"loadeddata",a[5]),C=!0)},p(E,I){I&16&&!Ue(t.src,f=E[4].certificateData.videoUrl)&&n(t,"src",f),E[3]?m&&(m.d(1),m=null):m||(m=dt(),m.c(),m.m(s,null))},d(E){E&&v(e),a[12](null),m&&m.d(),C=!1,T()}}}function dt(a){let e,s='<div class="text-yellow-500">加载中...</div>';return{c(){e=i("div"),e.innerHTML=s,this.h()},l(t){e=r(t,"DIV",{class:!0,"data-svelte-h":!0}),V(e)!=="svelte-q26451"&&(e.innerHTML=s),this.h()},h(){n(e,"class","absolute inset-0 bg-black flex items-center justify-center")},m(t,u){O(t,e,u)},d(t){t&&v(e)}}}function yt(a){let e;return{c(){e=te("📄 生成PDF证书")},l(s){e=le(s,"📄 生成PDF证书")},m(s,t){O(s,e,t)},d(s){s&&v(e)}}}function wt(a){let e,s=`<div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
							生成中...`;return{c(){e=i("span"),e.innerHTML=s,this.h()},l(t){e=r(t,"SPAN",{class:!0,"data-svelte-h":!0}),V(e)!=="svelte-1otsj2i"&&(e.innerHTML=s),this.h()},h(){n(e,"class","flex items-center gap-2")},m(t,u){O(t,e,u)},d(t){t&&v(e)}}}function ct(a){let e,s="💾 下载证书",t,u;return{c(){e=i("button"),e.textContent=s,this.h()},l(b){e=r(b,"BUTTON",{class:!0,"data-svelte-h":!0}),V(e)!=="svelte-41oajt"&&(e.textContent=s),this.h()},h(){n(e,"class","px-6 py-3 bg-gradient-to-r from-green-600 to-green-500 text-white font-semibold rounded-xl hover:from-green-500 hover:to-green-400 transition-all duration-300")},m(b,f){O(b,e,f),t||(u=ce(e,"click",a[7]),t=!0)},p:Ne,d(b){b&&v(e),t=!1,u()}}}function ft(a){let e,s,t="⚠️",u,b,f="验证失败",c,d,o=a[4].error+"",g,C,T,m,E="重试验证",I,D,H="跳过验证",q,h;return{c(){e=i("div"),s=i("div"),s.textContent=t,u=x(),b=i("h2"),b.textContent=f,c=x(),d=i("p"),g=te(o),C=x(),T=i("div"),m=i("button"),m.textContent=E,I=x(),D=i("button"),D.textContent=H,this.h()},l(p){e=r(p,"DIV",{class:!0});var _=w(e);s=r(_,"DIV",{class:!0,"data-svelte-h":!0}),V(s)!=="svelte-gp558o"&&(s.textContent=t),u=y(_),b=r(_,"H2",{class:!0,"data-svelte-h":!0}),V(b)!=="svelte-1sbotgz"&&(b.textContent=f),c=y(_),d=r(_,"P",{class:!0});var B=w(d);g=le(B,o),B.forEach(v),C=y(_),T=r(_,"DIV",{class:!0});var P=w(T);m=r(P,"BUTTON",{class:!0,"data-svelte-h":!0}),V(m)!=="svelte-1y4uxgf"&&(m.textContent=E),I=y(P),D=r(P,"BUTTON",{class:!0,"data-svelte-h":!0}),V(D)!=="svelte-1pavq1o"&&(D.textContent=H),P.forEach(v),_.forEach(v),this.h()},h(){n(s,"class","text-6xl mb-4"),n(b,"class","text-2xl font-semibold text-red-400 mb-4"),n(d,"class","text-red-300 mb-6"),n(m,"class","px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold rounded-xl hover:from-blue-500 hover:to-blue-400 transition-all duration-300"),n(D,"class","px-6 py-3 border-2 border-yellow-500 text-yellow-500 font-semibold rounded-xl hover:bg-yellow-500 hover:text-black transition-all duration-300"),n(T,"class","flex flex-col sm:flex-row gap-4"),n(e,"class","text-center max-w-md")},m(p,_){O(p,e,_),l(e,s),l(e,u),l(e,b),l(e,c),l(e,d),l(d,g),l(e,C),l(e,T),l(T,m),l(T,I),l(T,D),q||(h=[ce(m,"click",a[9]),ce(D,"click",a[10])],q=!0)},p(p,_){_&16&&o!==(o=p[4].error+"")&&de(g,o)},d(p){p&&v(e),q=!1,ut(h)}}}function Dt(a){let e,s,t,u,b,f=(a[4].status==="scanning"||a[4].status==="fetching")&&it(),c=(a[4].status==="fetched"||a[4].status==="generating_pdf"||a[4].status==="pdf_ready")&&rt(a),d=a[4].status==="error"&&ft(a);return{c(){e=i("meta"),s=x(),t=i("div"),f&&f.c(),u=x(),c&&c.c(),b=x(),d&&d.c(),this.h()},l(o){const g=bt("svelte-1ubv01i",je.head);e=r(g,"META",{name:!0,content:!0}),g.forEach(v),s=y(o),t=r(o,"DIV",{class:!0});var C=w(t);f&&f.l(C),u=y(C),c&&c.l(C),b=y(C),d&&d.l(C),C.forEach(v),this.h()},h(){je.title="验真开光证书 - 交个神仙朋友",n(e,"name","description"),n(e,"content","验证您的沉香手串开光证书，确保来源正宗"),n(t,"class","min-h-screen flex flex-col items-center justify-center p-6")},m(o,g){l(je.head,e),O(o,s,g),O(o,t,g),f&&f.m(t,null),l(t,u),c&&c.m(t,null),l(t,b),d&&d.m(t,null)},p(o,[g]){o[4].status==="scanning"||o[4].status==="fetching"?f||(f=it(),f.c(),f.m(t,u)):f&&(f.d(1),f=null),o[4].status==="fetched"||o[4].status==="generating_pdf"||o[4].status==="pdf_ready"?c?c.p(o,g):(c=rt(o),c.c(),c.m(t,b)):c&&(c.d(1),c=null),o[4].status==="error"?d?d.p(o,g):(d=ft(o),d.c(),d.m(t,null)):d&&(d.d(1),d=null)},i:Ne,o:Ne,d(o){o&&(v(s),v(t)),v(e),f&&f.d(),c&&c.d(),d&&d.d()}}}function kt(a,e,s){let t,u,b;st(a,xt,h=>s(14,u=h)),st(a,R,h=>s(11,b=h));let f="",c,d,o=!1;ht(()=>{s(0,f=u.url.searchParams.get("id")||""),f&&(R.update(h=>({...h,status:"scanning",nfcId:f})),g(f)),me("page_view",{page:"sanctify",nfcId:f})});async function g(h){R.update(p=>({...p,status:"fetching"}));try{const p=await fetch(`/api/cert/${h}`);if(!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);const _=await p.json();R.update(B=>({...B,status:"fetched",certificateData:_}))}catch(p){console.error("Certificate fetch failed:",p),R.update(_=>({..._,status:"error",error:p.message||"无法验证手串真伪，请检查网络连接"}))}}function C(){s(3,o=!0),c&&c.play().catch(console.error)}async function T(){R.update(h=>({...h,status:"generating_pdf"})),me("pdf_generate_start");try{const h=new Blob(["Mock PDF content"],{type:"application/pdf"});R.update(p=>({...p,status:"pdf_ready",pdfBlob:h})),me("pdf_generate_success")}catch(h){console.error("PDF generation failed:",h),R.update(p=>({...p,status:"error",error:h.message||"PDF生成失败"})),me("pdf_generate_error",{error:h.message})}}function m(){var B,P;const h=t.pdfBlob;if(!h)return;const p=URL.createObjectURL(h),_=document.createElement("a");_.href=p,_.download=`古寺开光证书_${((B=t.certificateData)==null?void 0:B.hash)||"unknown"}.pdf`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(p),me("pdf_download",{hash:(P=t.certificateData)==null?void 0:P.hash})}function E(){gt.update(h=>({...h,certificateData:t.certificateData})),nt("/awake")}function I(){R.update(h=>({...h,status:"idle",error:null})),f&&g(f)}function D(){nt("/awake")}function H(h){at[h?"unshift":"push"](()=>{c=h,s(1,c)})}function q(h){at[h?"unshift":"push"](()=>{d=h,s(2,d)})}return a.$$.update=()=>{a.$$.dirty&2048&&s(4,t=b)},[f,c,d,o,t,C,T,m,E,I,D,b,H,q]}class Tt extends mt{constructor(e){super(),pt(this,e,kt,Dt,vt,{})}}export{Tt as component};
